# Laasti/Stack

A middleware stack with 3 phases:

1. Prepare is where you adapt the request;
2. Respond is where you modify the response generated by the prepare phase;
3. Close is where you output the response and close the current request (ie. closing a session, sending an e-mail...);

Laasti\Stack has 1 dependency: [symfony/http-foundation](https://github.com/symfony/HttpFoundation). I chose it because
it handles requests and responses in a straightforward fashion. I am waiting for PSR7 to mature
and will eventually remove the dependency on HttpFoundation in favour of the PSR7 standard.

It also provides an integration with League\Container.

## Installation

```
composer require laasti/stack
```

## Usage

Without League\Container:

```
$stack = new Laasti\Stack\Stack;

//You must at least have one PrepareableMiddleware that returns a Response
$stack->push(new MyPrepareableMiddleware);

//Ouputs the response automatically
$stack->execute(Request::createFromGlobals());
```

With League\Container:

```
$container = new League\Container\Container;
$resolver = new Laasti\Stack\ContainerResolver($container);
$stack = new Laasti\Stack\Stack($resolver);
$container->add('MyPrepareableMiddleware');

//You must at least have one PrepareableMiddleware that returns a Response
$stack->push('MyPrepareableMiddleware');

//Ouputs the response automatically
$stack->execute(Request::createFromGlobals());
```

> If you encounter problems with priority, make sure that your middlewares define just one of the middleware types.
> Also make sure your middlewares do as little as possible so that you can fine tune the priority more easily.

## Contributing

1. Fork it!
2. Create your feature branch: `git checkout -b my-new-feature`
3. Commit your changes: `git commit -am 'Add some feature'`
4. Push to the branch: `git push origin my-new-feature`
5. Submit a pull request :D

## History

See CHANGELOG.md for more information.

## Credits

Author: Sonia Marquette (@nebulousGirl)

## License

Released under the MIT License. See LICENSE file.

